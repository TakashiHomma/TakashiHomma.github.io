<html>
<head></head>
<body>
<!--キャンバス-->
<canvas id="my_canvas" width="600" height="450"></canvas>
<br>
<textarea id="canvas_text" cols="10" rows="5">テキスト</textarea>
<!--ダウンロード用ボタン-->
<button id="input_button">文字描画</button>
<button id="download_button">ダウンロードする</button>
<button id="load_text">文字読み込み</button>
<!--ダウンロード用リンク-->
<a id="download_link"></a>
<script>

    window.onload = function(){

        var canvas = document.getElementById('my_canvas');
        var downloadLink = document.getElementById('download_link');
        var filename = 'UnityImageIn.png';
	var x = canvas.width / 2;
	var y = canvas.height / 3;

	var button2 = document.getElementById('load_text');
        button2.addEventListener('click', function(){
	alert("https://scrapbox.io/api/code/tsukalab/ブラインドディスプレイ/内側.txt" + '\n' + "https://scrapbox.io/api/code/tsukalab/ブラインドディスプレイ/外側.txt");
	});

	var button1 = document.getElementById('input_button');
        button1.addEventListener('click', function(){
	var text = document.getElementById('canvas_text').value;

        /*  テストのために描画  */
        var ctx = canvas.getContext('2d');
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.font = 'bold 128px MS ゴシック';
        ctx.fillStyle = '#000080';
	ctx.textBaseline = 'center';
	ctx.textAlign = 'center';
	for( var lines=text.split( "\n" ), i=0, l=lines.length; l>i; i++ ) {
	var line = lines[i];
	var addY = 128;
	var sum = 0;
	if(i) sum += addY * i;
        ctx.fillText(line, x, y + sum);
	}
	});

        var button = document.getElementById('download_button');
        button.addEventListener('click', function(){

            if (canvas.msToBlob) {
                var blob = canvas.msToBlob();
                window.navigator.msSaveBlob(blob, filename);
            } else {
                downloadLink.href = canvas.toDataURL('image/png');
                downloadLink.download = filename;
                downloadLink.click();
            }

        });

    };

</script>
</body>
</html>
